<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx使用指南 | L.Rain的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="L.Rain的博客">
    <link rel="preload" href="/assets/css/0.styles.0b94e76f.css" as="style"><link rel="preload" href="/assets/js/app.068c2f58.js" as="script"><link rel="preload" href="/assets/js/7.8545d9f8.js" as="script"><link rel="preload" href="/assets/js/34.b3f1b851.js" as="script"><link rel="prefetch" href="/assets/js/1.f6e0f07f.js"><link rel="prefetch" href="/assets/js/10.4a6afb4e.js"><link rel="prefetch" href="/assets/js/100.0cd1e5cb.js"><link rel="prefetch" href="/assets/js/101.6d1049ef.js"><link rel="prefetch" href="/assets/js/102.ca30a59f.js"><link rel="prefetch" href="/assets/js/103.7726e0e4.js"><link rel="prefetch" href="/assets/js/104.c1301baf.js"><link rel="prefetch" href="/assets/js/105.01ade4cd.js"><link rel="prefetch" href="/assets/js/106.29433bd0.js"><link rel="prefetch" href="/assets/js/107.b03e8b24.js"><link rel="prefetch" href="/assets/js/108.3b062e41.js"><link rel="prefetch" href="/assets/js/109.18e11700.js"><link rel="prefetch" href="/assets/js/11.d13437d4.js"><link rel="prefetch" href="/assets/js/110.d305c24a.js"><link rel="prefetch" href="/assets/js/111.e6b8b82d.js"><link rel="prefetch" href="/assets/js/112.14c70834.js"><link rel="prefetch" href="/assets/js/113.36995905.js"><link rel="prefetch" href="/assets/js/114.e5287e2c.js"><link rel="prefetch" href="/assets/js/115.5fe238c3.js"><link rel="prefetch" href="/assets/js/116.8e429b54.js"><link rel="prefetch" href="/assets/js/117.d8fe895d.js"><link rel="prefetch" href="/assets/js/118.c45469ec.js"><link rel="prefetch" href="/assets/js/119.5d3fe1d4.js"><link rel="prefetch" href="/assets/js/12.7d7635cb.js"><link rel="prefetch" href="/assets/js/13.919964bf.js"><link rel="prefetch" href="/assets/js/14.5ff823ae.js"><link rel="prefetch" href="/assets/js/15.f094c0ad.js"><link rel="prefetch" href="/assets/js/16.907cfa61.js"><link rel="prefetch" href="/assets/js/17.68c10889.js"><link rel="prefetch" href="/assets/js/18.12534d82.js"><link rel="prefetch" href="/assets/js/19.c95b0e90.js"><link rel="prefetch" href="/assets/js/20.cde68641.js"><link rel="prefetch" href="/assets/js/21.d578bfc7.js"><link rel="prefetch" href="/assets/js/22.cc1a699d.js"><link rel="prefetch" href="/assets/js/23.70bfef65.js"><link rel="prefetch" href="/assets/js/24.1af4adb4.js"><link rel="prefetch" href="/assets/js/25.5ebf30fd.js"><link rel="prefetch" href="/assets/js/26.4517a9fa.js"><link rel="prefetch" href="/assets/js/27.e7d587d3.js"><link rel="prefetch" href="/assets/js/28.50cc77dd.js"><link rel="prefetch" href="/assets/js/29.74bb572b.js"><link rel="prefetch" href="/assets/js/3.abcd40dc.js"><link rel="prefetch" href="/assets/js/30.d09f9f0a.js"><link rel="prefetch" href="/assets/js/31.b9416bd5.js"><link rel="prefetch" href="/assets/js/32.d180d63d.js"><link rel="prefetch" href="/assets/js/33.2b4d3a05.js"><link rel="prefetch" href="/assets/js/35.b2f85471.js"><link rel="prefetch" href="/assets/js/36.87b4aa21.js"><link rel="prefetch" href="/assets/js/37.205dcceb.js"><link rel="prefetch" href="/assets/js/38.537b1c83.js"><link rel="prefetch" href="/assets/js/39.df3a9d76.js"><link rel="prefetch" href="/assets/js/4.037891d1.js"><link rel="prefetch" href="/assets/js/40.fdd6c52a.js"><link rel="prefetch" href="/assets/js/41.aebbd2f8.js"><link rel="prefetch" href="/assets/js/42.05ea98be.js"><link rel="prefetch" href="/assets/js/43.b28e38da.js"><link rel="prefetch" href="/assets/js/44.7fc33c3f.js"><link rel="prefetch" href="/assets/js/45.49c01d46.js"><link rel="prefetch" href="/assets/js/46.d8206208.js"><link rel="prefetch" href="/assets/js/47.1406a8e4.js"><link rel="prefetch" href="/assets/js/48.680b3167.js"><link rel="prefetch" href="/assets/js/49.5d634f35.js"><link rel="prefetch" href="/assets/js/5.023c6154.js"><link rel="prefetch" href="/assets/js/50.c9d5c85b.js"><link rel="prefetch" href="/assets/js/51.3b049ffa.js"><link rel="prefetch" href="/assets/js/52.f6891e69.js"><link rel="prefetch" href="/assets/js/53.2a1b89f9.js"><link rel="prefetch" href="/assets/js/54.5fd7e816.js"><link rel="prefetch" href="/assets/js/55.8bbe2a85.js"><link rel="prefetch" href="/assets/js/56.a85b7d61.js"><link rel="prefetch" href="/assets/js/57.b595c295.js"><link rel="prefetch" href="/assets/js/58.57df37bd.js"><link rel="prefetch" href="/assets/js/59.13b6880c.js"><link rel="prefetch" href="/assets/js/6.118b5a7a.js"><link rel="prefetch" href="/assets/js/60.39b4662c.js"><link rel="prefetch" href="/assets/js/61.b001685b.js"><link rel="prefetch" href="/assets/js/62.79af8aa9.js"><link rel="prefetch" href="/assets/js/63.be39ab32.js"><link rel="prefetch" href="/assets/js/64.60d3c7b6.js"><link rel="prefetch" href="/assets/js/65.6a63e2f0.js"><link rel="prefetch" href="/assets/js/66.9e701cff.js"><link rel="prefetch" href="/assets/js/67.0ee08695.js"><link rel="prefetch" href="/assets/js/68.d06ebeb4.js"><link rel="prefetch" href="/assets/js/69.caca86d2.js"><link rel="prefetch" href="/assets/js/70.c3dee498.js"><link rel="prefetch" href="/assets/js/71.e84da91b.js"><link rel="prefetch" href="/assets/js/72.feb39ddf.js"><link rel="prefetch" href="/assets/js/73.4166c05e.js"><link rel="prefetch" href="/assets/js/74.910e482b.js"><link rel="prefetch" href="/assets/js/75.6e0749f8.js"><link rel="prefetch" href="/assets/js/76.6f81437f.js"><link rel="prefetch" href="/assets/js/77.dbdae14f.js"><link rel="prefetch" href="/assets/js/78.69e0c72d.js"><link rel="prefetch" href="/assets/js/79.42b8aad9.js"><link rel="prefetch" href="/assets/js/8.51c6e2dd.js"><link rel="prefetch" href="/assets/js/80.826b287f.js"><link rel="prefetch" href="/assets/js/81.6aac02f2.js"><link rel="prefetch" href="/assets/js/82.a5939b97.js"><link rel="prefetch" href="/assets/js/83.3fdee807.js"><link rel="prefetch" href="/assets/js/84.49fd39bb.js"><link rel="prefetch" href="/assets/js/85.bdfe7400.js"><link rel="prefetch" href="/assets/js/86.a5ce4449.js"><link rel="prefetch" href="/assets/js/87.f707e5fc.js"><link rel="prefetch" href="/assets/js/88.c3dea5b9.js"><link rel="prefetch" href="/assets/js/89.01969c4f.js"><link rel="prefetch" href="/assets/js/9.50140b23.js"><link rel="prefetch" href="/assets/js/90.9ef0dffe.js"><link rel="prefetch" href="/assets/js/91.1501afdf.js"><link rel="prefetch" href="/assets/js/92.5430d9d9.js"><link rel="prefetch" href="/assets/js/93.9d468cbf.js"><link rel="prefetch" href="/assets/js/94.5045a6ae.js"><link rel="prefetch" href="/assets/js/95.915acd27.js"><link rel="prefetch" href="/assets/js/96.7e834eea.js"><link rel="prefetch" href="/assets/js/97.dba3ef0c.js"><link rel="prefetch" href="/assets/js/98.bb5d4813.js"><link rel="prefetch" href="/assets/js/99.3f52d055.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0b94e76f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(https://picsum.photos/1920/250.webp);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          L.Rain的博客
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/" class="navbar-link" data-v-e4145d0a>
            主页
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            分类
          </a><a href="https://github.com/baixiaoyu2997" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-e4145d0a><span data-v-e4145d0a>Github</span> <span data-v-e4145d0a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          Nginx使用指南
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2021-07-16
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2022-04-07
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2021/07/07/mysql%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html" class="post-link" data-v-4e23451f>
      上一篇 : MySql使用指南
    </a> <a href="/posts/2021/07/20/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97.html" class="post-link" data-v-4e23451f>
      下一篇 : 区块链学习指南
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>Nginx是一个高性能的HTTP和反向代理web服务器，负责服务器的转发和请求处理、负载均衡。</p> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <p>内存占用少，并发能力强，可以不间断服务的情况下进行软件版本的升级。由<code>c</code>语言编写</p> <h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <p>Nginx提供的负载均衡策略有2种：内置策略和扩展策略。</p> <p>内置策略：轮询，加权轮询，ip hash。</p> <p>扩展策略</p> <h3 id="session共享"><a href="#session共享" class="header-anchor">#</a> Session共享</h3> <p>推荐使用Redis来处理</p> <h3 id="动静分离"><a href="#动静分离" class="header-anchor">#</a> 动静分离</h3> <p>静态文件直接放在Nginx服务器上做缓存，不需要下放到其他服务器</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <h3 id="mac"><a href="#mac" class="header-anchor">#</a> mac</h3> <p><code>brew install nginx</code></p> <h3 id="debian"><a href="#debian" class="header-anchor">#</a> debian</h3> <div class="language- extra-class"><pre class="language-text"><code>sudo apt-get update
sudo apt-get install nginx
</code></pre></div><p>安装完成后会自动运行服务，默认的nginx html位置在<code>/usr/share/nginx/html/index.html</code></p> <h2 id="命令行"><a href="#命令行" class="header-anchor">#</a> 命令行</h2> <ol><li>-s stop 停止</li> <li>-s quit 安全退出</li> <li>-s reload 重新加载配置文件</li> <li><code>ps aux|grep nginx</code> 查看进程是否存在</li></ol> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p>nginx的配置文件为<code>nginx.conf</code>， 每一个配置项以<code>;</code>结尾，修改完配置文件后，需要使用<code>reload</code>命令。</p> <h3 id="全局配置"><a href="#全局配置" class="header-anchor">#</a> 全局配置</h3> <p><code>#</code>号开头的配置为全局配置</p> <h3 id="导入子配置文件"><a href="#导入子配置文件" class="header-anchor">#</a> 导入子配置文件</h3> <p>使用<code>include</code>可以导入其他配置文件</p> <h3 id="特殊单位"><a href="#特殊单位" class="header-anchor">#</a> 特殊单位</h3> <h4 id="字节单位"><a href="#字节单位" class="header-anchor">#</a> 字节单位</h4> <p><code>1024、8k、1m</code></p> <h4 id="时间单位"><a href="#时间单位" class="header-anchor">#</a> 时间单位</h4> <div class="language- extra-class"><pre class="language-text"><code>ms milliseconds
s	seconds
m	minutes
h	hours
d	days
w	weeks
M	months, 30 days
y
</code></pre></div><p>值没有单位的表示秒。时间单位可以组合，例如<code>1h 30m</code>，使用空格分隔。</p> <p>有些配置只能使用秒来指定。</p> <h3 id="结构"><a href="#结构" class="header-anchor">#</a> 结构</h3> <div class="language- extra-class"><pre class="language-text"><code>... #全局块
events { #events块
...
}
http #http块
{
    ... #http全局块
    server #server块
    { 
        ... #server全局块
        location [PATTERN] #location块
        {
            ...
        }
        location [PATTERN] 
        {
            ...
        }
     }
    server
    {
        ...
    }
    ... #http全局块
}
</code></pre></div><h3 id="变量"><a href="#变量" class="header-anchor">#</a> 变量</h3> <p>使用<code>set</code>设置变量<code>set $geek_web_root &quot;/Users/doing/IdeaProjects/backend-geek-web&quot;;</code></p> <h4 id="内置变量"><a href="#内置变量" class="header-anchor">#</a> 内置变量</h4> <p>除了手动设置变量，内部还提供了一些变量可以使用：</p> <div class="language- extra-class"><pre class="language-text"><code>$args ：这个变量等于请求行中的参数，同$query_string
$content_length ： 请求头中的Content-length字段。
$content_type ： 请求头中的Content-Type字段。
$document_root ： 当前请求在root指令中指定的值。
$host ： 请求主机头字段，否则为服务器名称。
$http_user_agent ： 客户端agent信息
$http_cookie ： 客户端cookie信息
$limit_rate ： 这个变量可以限制连接速率。
$request_method ： 客户端请求的动作，通常为GET或POST。
$remote_addr ： 客户端的IP地址。
$remote_port ： 客户端的端口。
$remote_user ： 已经经过Auth Basic Module验证的用户名。
$request_filename ： 当前请求的文件路径，由root或alias指令与URI请求生成。
$scheme ： HTTP方法（如http，https）。
$server_protocol ： 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。
$server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。
$server_name ： 服务器名称。
$server_port ： 请求到达服务器的端口号。
$request_uri ： 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。
$uri ： 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。
$document_uri ： 与$uri相同。
</code></pre></div><h3 id="全局块"><a href="#全局块" class="header-anchor">#</a> 全局块</h3> <p>配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。</p> <div class="language- extra-class"><pre class="language-text"><code>#配置用户或者组，默认为nobody nobody。
#user administrator administrators; 
#允许生成的进程数，默认为1
#worker_processes 2; 
#指定nginx进程运行文件存放地址
#pid /nginx/pid/nginx.pid; 
#制定错误日志路径，级别。这个设置可以放入全局块，http块，server块，级别依次为：debug|info|notice|warn|error|crit|alert|emerg
error_log log/error.log debug; 
</code></pre></div><h3 id="events"><a href="#events" class="header-anchor">#</a> events</h3> <p>配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</p> <div class="language- extra-class"><pre class="language-text"><code>#工作模式及连接数上限
events {
#设置网路连接序列化，防止惊群现象发生，默认为on
   accept_mutex on; 
#设置一个进程是否同时接受多个网络连接，默认为off
   multi_accept on; 
#事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport
#use epoll; 
#单个work进程允许的最大连接数，默认为512
   worker_connections 1024; 
}
</code></pre></div><h3 id="http"><a href="#http" class="header-anchor">#</a> http</h3> <p>可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</p> <div class="language- extra-class"><pre class="language-text"><code>#http服务器
http {
tcp_nopush on;
#文件扩展名与文件类型映射表。设定mime类型(邮件支持类型),类型由mime.types文件定义
#include /usr/local/etc/nginx/conf/mime.types;
   include mime.types; 
#默认文件类型，默认为text/plain
   default_type application/octet-stream;  // 默认未知类型
#取消服务访问日志
#access_log off;     
#自定义日志格式
   log_format myFormat '$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'; 
#设置访问日志路径和格式。&quot;log/&quot;该路径为nginx日志的相对路径，mac下是/usr/local/var/log/。combined为日志格式的默认值
   access_log log/access.log myFormat; 
   rewrite_log on;
#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。（sendfile系统调用不需要将数据拷贝或者映射到应用程序地址空间中去）
   sendfile on; 
#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。
   sendfile_max_chunk 100k; 
#连接超时时间，默认为75s，可以在http，server，location块。
   keepalive_timeout 65; 
#gzip压缩开关
#gzip on;
   tcp_nodelay on;
#设定实际的服务器列表
   upstream mysvr1 {   
     server 127.0.0.1:7878;
     server 192.168.10.121:3333 backup; #热备(其它所有的非backup机器down或者忙的时候，请求backup机器))
   }
   upstream mysvr2 {
#weigth参数表示权值，权值越高被分配到的几率越大
     server 192.168.1.11:80 weight=5;
     server 192.168.1.12:80 weight=1;
     server 192.168.1.13:80 weight=6;
   }
   upstream https-svr {
#每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题
     ip_hash;
     server 192.168.1.11:90;
     server 192.168.1.12:90;
   }
#error_page 404 https://www.baidu.com; #错误页
#HTTP服务器
# 静态资源一般放在nginx所在主机
   server {
       listen 80; #监听HTTP端口
       server_name 127.0.0.1; #监听地址  
       keepalive_requests 120; #单连接请求上限次数
       set $doc_root_dir &quot;/Users/doing/IdeaProjects/edu-front-2.0&quot;; #设置server里全局变量
       #index index.html;  #定义首页索引文件的名称
       location ~*^.+$ { #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。
          root $doc_root_dir; #静态资源根目录
          proxy_pass http://mysvr1; #请求转向“mysvr1”定义的服务器列表
          #deny 127.0.0.1; #拒绝的ip
          #allow 172.18.5.54; #允许的ip           
       } 
   }
#http
   server {
       listen 80;
       server_name www.helloworld.com; #监听基于域名的虚拟主机。可有多个，可以使用正则表达式和通配符
       charset utf-8; #编码格式
       set $static_root_dir &quot;/Users/doing/static&quot;;
       location /app1 { #反向代理的路径（和upstream绑定），location后面设置映射的路径 
           proxy_pass http://zp_server1;
       } 
       location /app2 {  
           proxy_pass http://zp_server2;
       } 
       location ~ ^/(images|javascript|js|css|flash|media|static)/ {  #静态文件，nginx自己处理
           root $static_root_dir;
           expires 30d; #静态资源过时间30天
       }
       location ~ /\.ht {  #禁止访问 .htxxx 文件
           deny all;
       }
       location = /do_not_delete.html { #直接简单粗暴的返回状态码及内容文本
           return 200 &quot;hello.&quot;;
       }
# 指定某些路径使用https访问(使用正则表达式匹配路径+重写uri路径)
       location ~* /http* { #路径匹配规则：如localhost/http、localhost/httpsss等等
#rewrite只能对域名后边的除去传递的参数外的字符串起作用，例如www.c.com/proxy/html/api/msg?method=1&amp;para=2只能对/proxy/html/api/msg重写。
#rewrite 规则 定向路径 重写类型;
#rewrite后面的参数是一个简单的正则。$1代表正则中的第一个()。
#$host是nginx内置全局变量，代表请求的主机名
#重写规则permanent表示返回301永久重定向
           rewrite ^/(.*)$ https://$host/$1 permanent;
       }
#错误处理页面（可选择性配置）
#error_page 404 /404.html;
#error_page 500 502 503 504 /50x.html;
#以下是一些反向代理的配置(可选择性配置)
#proxy_redirect off;
#proxy_set_header Host $host; #proxy_set_header用于设置发送到后端服务器的request的请求头
#proxy_set_header X-Real-IP $remote_addr;
#proxy_set_header X-Forwarded-For $remote_addr; #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP
#proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)
#proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)
#proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)
#proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小
#proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置
#proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）
#proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传
#client_max_body_size 10m; #允许客户端请求的最大单文件字节数
#client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数
   }
#https
#(1)HTTPS的固定端口号是443，不同于HTTP的80端口；
#(2)SSL标准需要引入安全证书，所以在 nginx.conf 中你需要指定证书和它对应的 key
   server {
     listen 443;
     server_name  www.hellohttps1.com www.hellohttps2.com;
     set $geek_web_root &quot;/Users/doing/IdeaProjects/backend-geek-web&quot;;
     ssl_certificate      /usr/local/etc/nginx/ssl-key/ssl.crt; #ssl证书文件位置(常见证书文件格式为：crt/pem)
     ssl_certificate_key  /usr/local/etc/nginx/ssl-key/ssl.key; #ssl证书key位置
     location /passport {
       send_timeout 90;
       proxy_connect_timeout 50;
       proxy_send_timeout 90;
       proxy_read_timeout 90;
       proxy_pass http://https-svr;
     }
     location ~ ^/(res|lib)/ {
        root $geek_web_root; 
        expires 7d;
#add_header用于为后端服务器返回的response添加请求头，这里通过add_header实现CROS跨域请求服务器
        add_header Access-Control-Allow-Origin *; 
     }
#ssl配置参数（选择性配置）
     ssl_session_cache shared:SSL:1m;
     ssl_session_timeout 5m;
   }
#配置访问控制：每个IP一秒钟只处理一个请求，超出的请求会被delayed
#语法：limit_req_zone  $session_variable  zone=name:size  rate=rate (为session会话状态分配一个大小为size的内存存储区，限制了每秒（分、小时）只接受rate个IP的频率)
   limit_req_zone  $binary_remote_addr zone=req_one:10m   rate=1r/s nodelay;
   location /pay {
        proxy_set_header Host $http_host;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#访问控制：limit_req zone=name [burst=number] [nodelay];
        limit_req zone=req_one burst=5; #burst=5表示超出的请求(被delayed)如果超过5个，那些请求会被终止（默认返回503）
        proxy_pass http://mysvr1;
   }
#可以把子配置文件放到/usr/local/etc/nginx/servers/路径下，通过include引入
   include /usr/local/etc/nginx/servers/*.conf;
} 
</code></pre></div><h4 id="server"><a href="#server" class="header-anchor">#</a> server</h4> <p>配置虚拟主机的相关参数，一个http中可以有多个server。</p> <h4 id="location"><a href="#location" class="header-anchor">#</a> location</h4> <p>配置请求的路由，以及各种页面的处理情况。</p> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <h3 id="如何验证是本地提供的nginx服务"><a href="#如何验证是本地提供的nginx服务" class="header-anchor">#</a> 如何验证是本地提供的nginx服务？</h3> <p>如何确定就是本地 nginx 提供的服务呢？有 2 个方法：</p> <ul><li>方法一：<strong>PING</strong></li></ul> <p>ping ip，看看是否解析到设置的url，比如<a href="https://link.zhihu.com/?target=http%3A//baidu.com" target="_blank" rel="noopener noreferrer">http://baidu.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等</p> <ul><li>方法二：<strong>观察访问日志</strong></li></ul> <p>查看nginx 服务器的访问日志，看nginx 服务器是否能够正常提供服务。</p></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2021-07-16
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2022-04-07
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2021/07/07/mysql%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html" class="post-link" data-v-4e23451f>
      上一篇 : MySql使用指南
    </a> <a href="/posts/2021/07/20/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97.html" class="post-link" data-v-4e23451f>
      下一篇 : 区块链学习指南
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" data-v-9d847660><img src="https://avatars.githubusercontent.com/baixiaoyu2997?s=120" alt="L.Rain" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      L.Rain
    </section> <section class="info-desc" data-v-9d847660>真实、自由、宽容</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="ChengDu City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>ChengDu City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          ChengDu City, China
        </span></span></section> <section data-v-9d847660><span title="ChengDu YeeYun Technology" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>ChengDu YeeYun Technology</title><use xlink:href="#icon-organization" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          ChengDu YeeYun Technology
        </span></span></section> <section data-v-9d847660><a href="mailto:bxy2997@sina.com" title="bxy2997@sina.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>bxy2997@sina.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          bxy2997@sina.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/baixiaoyu2997" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: L.Rain" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: L.Rain</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a><a href="https://weibo.com/1504398495" target="_blank" class="sns-link" data-v-9d847660><span title="新浪微博: 白晓宇V" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>新浪微博: 白晓宇V</title><use xlink:href="#icon-weibo" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#介绍">介绍</a><ul><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#特点">特点</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#负载均衡">负载均衡</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#session共享">Session共享</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#动静分离">动静分离</a></li></ul></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#安装">安装</a><ul><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#mac">mac</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#debian">debian</a></li></ul></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#命令行">命令行</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#配置">配置</a><ul><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#全局配置">全局配置</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#导入子配置文件">导入子配置文件</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#特殊单位">特殊单位</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#结构">结构</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#变量">变量</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#全局块">全局块</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#events">events</a></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#http">http</a></li></ul></li><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#问题">问题</a><ul><li><a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#如何验证是本地提供的nginx服务">如何验证是本地提供的nginx服务？</a></li></ul></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2021/07/16/nginx%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/baixiaoyu2997" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: L.Rain" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: L.Rain</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a><a href="https://weibo.com/1504398495" target="_blank" class="sns-link" data-v-1375e54c><span title="新浪微博: 白晓宇V" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>新浪微博: 白晓宇V</title><use xlink:href="#icon-weibo" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <p class="footer-text" data-v-1375e54c><span data-v-1375e54c>Powered by </span> <a href="https://github.com/vuejs/vuepress" target="_blank" data-v-1375e54c>
      VuePress
    </a> <span data-v-1375e54c> | </span> <a href="https://github.com/meteorlxy/vuepress-theme-meteorlxy" target="_blank" data-v-1375e54c>
        meteorlxy
      </a></p> <!----></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.068c2f58.js" defer></script><script src="/assets/js/7.8545d9f8.js" defer></script><script src="/assets/js/34.b3f1b851.js" defer></script>
  </body>
</html>
