<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Piniaå­¦ä¹ éšç¬” | L.Rainçš„åšå®¢</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="L.Rainçš„åšå®¢">
    <link rel="preload" href="/assets/css/0.styles.0b94e76f.css" as="style"><link rel="preload" href="/assets/js/app.f3f948e5.js" as="script"><link rel="preload" href="/assets/js/7.8545d9f8.js" as="script"><link rel="preload" href="/assets/js/37.1426b4d7.js" as="script"><link rel="prefetch" href="/assets/js/1.f6e0f07f.js"><link rel="prefetch" href="/assets/js/10.4a6afb4e.js"><link rel="prefetch" href="/assets/js/100.00690d66.js"><link rel="prefetch" href="/assets/js/101.b03e7e78.js"><link rel="prefetch" href="/assets/js/102.65326722.js"><link rel="prefetch" href="/assets/js/103.d406d78e.js"><link rel="prefetch" href="/assets/js/104.6a1f86e2.js"><link rel="prefetch" href="/assets/js/105.0f31792b.js"><link rel="prefetch" href="/assets/js/106.6c9ad918.js"><link rel="prefetch" href="/assets/js/107.ee598287.js"><link rel="prefetch" href="/assets/js/108.b5fb77fe.js"><link rel="prefetch" href="/assets/js/109.b2439d14.js"><link rel="prefetch" href="/assets/js/11.d13437d4.js"><link rel="prefetch" href="/assets/js/110.0d63ca3f.js"><link rel="prefetch" href="/assets/js/111.2c66addd.js"><link rel="prefetch" href="/assets/js/112.d6da0f6e.js"><link rel="prefetch" href="/assets/js/113.87534de5.js"><link rel="prefetch" href="/assets/js/114.9d1d8fa1.js"><link rel="prefetch" href="/assets/js/115.ff10b6f6.js"><link rel="prefetch" href="/assets/js/116.e20742ae.js"><link rel="prefetch" href="/assets/js/117.e7d8d1af.js"><link rel="prefetch" href="/assets/js/118.8ea36d1a.js"><link rel="prefetch" href="/assets/js/119.92e02005.js"><link rel="prefetch" href="/assets/js/12.7d7635cb.js"><link rel="prefetch" href="/assets/js/120.c1d798df.js"><link rel="prefetch" href="/assets/js/121.a3eb223d.js"><link rel="prefetch" href="/assets/js/13.919964bf.js"><link rel="prefetch" href="/assets/js/14.5ff823ae.js"><link rel="prefetch" href="/assets/js/15.99e9e2eb.js"><link rel="prefetch" href="/assets/js/16.cf847976.js"><link rel="prefetch" href="/assets/js/17.68c10889.js"><link rel="prefetch" href="/assets/js/18.12534d82.js"><link rel="prefetch" href="/assets/js/19.3c94f51e.js"><link rel="prefetch" href="/assets/js/20.1bd9be68.js"><link rel="prefetch" href="/assets/js/21.28d796df.js"><link rel="prefetch" href="/assets/js/22.bfdfc41c.js"><link rel="prefetch" href="/assets/js/23.2a062f7f.js"><link rel="prefetch" href="/assets/js/24.e18c817e.js"><link rel="prefetch" href="/assets/js/25.722a033a.js"><link rel="prefetch" href="/assets/js/26.01e9d959.js"><link rel="prefetch" href="/assets/js/27.4b7fbb8c.js"><link rel="prefetch" href="/assets/js/28.5f5c310e.js"><link rel="prefetch" href="/assets/js/29.463b5d28.js"><link rel="prefetch" href="/assets/js/3.abcd40dc.js"><link rel="prefetch" href="/assets/js/30.d09f9f0a.js"><link rel="prefetch" href="/assets/js/31.b9416bd5.js"><link rel="prefetch" href="/assets/js/32.d180d63d.js"><link rel="prefetch" href="/assets/js/33.2b4d3a05.js"><link rel="prefetch" href="/assets/js/34.641090b9.js"><link rel="prefetch" href="/assets/js/35.d50ed1d6.js"><link rel="prefetch" href="/assets/js/36.2d2c0cbe.js"><link rel="prefetch" href="/assets/js/38.0792bcd9.js"><link rel="prefetch" href="/assets/js/39.ee9f93e7.js"><link rel="prefetch" href="/assets/js/4.037891d1.js"><link rel="prefetch" href="/assets/js/40.4965c53c.js"><link rel="prefetch" href="/assets/js/41.dd9117e7.js"><link rel="prefetch" href="/assets/js/42.05ea98be.js"><link rel="prefetch" href="/assets/js/43.b28e38da.js"><link rel="prefetch" href="/assets/js/44.7fc33c3f.js"><link rel="prefetch" href="/assets/js/45.5eaf4dc1.js"><link rel="prefetch" href="/assets/js/46.bd48e39f.js"><link rel="prefetch" href="/assets/js/47.1406a8e4.js"><link rel="prefetch" href="/assets/js/48.680b3167.js"><link rel="prefetch" href="/assets/js/49.5d634f35.js"><link rel="prefetch" href="/assets/js/5.023c6154.js"><link rel="prefetch" href="/assets/js/50.c9d5c85b.js"><link rel="prefetch" href="/assets/js/51.3b049ffa.js"><link rel="prefetch" href="/assets/js/52.f6891e69.js"><link rel="prefetch" href="/assets/js/53.4aa54af0.js"><link rel="prefetch" href="/assets/js/54.6a9e6d10.js"><link rel="prefetch" href="/assets/js/55.8bbe2a85.js"><link rel="prefetch" href="/assets/js/56.a85b7d61.js"><link rel="prefetch" href="/assets/js/57.b595c295.js"><link rel="prefetch" href="/assets/js/58.57df37bd.js"><link rel="prefetch" href="/assets/js/59.7b090e92.js"><link rel="prefetch" href="/assets/js/6.118b5a7a.js"><link rel="prefetch" href="/assets/js/60.4d81b83e.js"><link rel="prefetch" href="/assets/js/61.2ebaff37.js"><link rel="prefetch" href="/assets/js/62.79af8aa9.js"><link rel="prefetch" href="/assets/js/63.b8fe69a6.js"><link rel="prefetch" href="/assets/js/64.f04f617d.js"><link rel="prefetch" href="/assets/js/65.a90b10c6.js"><link rel="prefetch" href="/assets/js/66.9e701cff.js"><link rel="prefetch" href="/assets/js/67.69accf88.js"><link rel="prefetch" href="/assets/js/68.02005b54.js"><link rel="prefetch" href="/assets/js/69.caca86d2.js"><link rel="prefetch" href="/assets/js/70.2aa39324.js"><link rel="prefetch" href="/assets/js/71.813d9785.js"><link rel="prefetch" href="/assets/js/72.feb39ddf.js"><link rel="prefetch" href="/assets/js/73.4166c05e.js"><link rel="prefetch" href="/assets/js/74.15141838.js"><link rel="prefetch" href="/assets/js/75.73494c15.js"><link rel="prefetch" href="/assets/js/76.85b76b27.js"><link rel="prefetch" href="/assets/js/77.d6bf62ba.js"><link rel="prefetch" href="/assets/js/78.49c87c7c.js"><link rel="prefetch" href="/assets/js/79.ec76b1f5.js"><link rel="prefetch" href="/assets/js/8.51c6e2dd.js"><link rel="prefetch" href="/assets/js/80.58b89a63.js"><link rel="prefetch" href="/assets/js/81.6ec4c951.js"><link rel="prefetch" href="/assets/js/82.9a316b1b.js"><link rel="prefetch" href="/assets/js/83.b62a35e8.js"><link rel="prefetch" href="/assets/js/84.81879853.js"><link rel="prefetch" href="/assets/js/85.96a2fd73.js"><link rel="prefetch" href="/assets/js/86.a9cf33e0.js"><link rel="prefetch" href="/assets/js/87.8eb3ec20.js"><link rel="prefetch" href="/assets/js/88.318384bb.js"><link rel="prefetch" href="/assets/js/89.3634cbfa.js"><link rel="prefetch" href="/assets/js/9.50140b23.js"><link rel="prefetch" href="/assets/js/90.0693c763.js"><link rel="prefetch" href="/assets/js/91.c8dbc323.js"><link rel="prefetch" href="/assets/js/92.9288651a.js"><link rel="prefetch" href="/assets/js/93.7488f678.js"><link rel="prefetch" href="/assets/js/94.c84bd54c.js"><link rel="prefetch" href="/assets/js/95.903d1a46.js"><link rel="prefetch" href="/assets/js/96.c483a229.js"><link rel="prefetch" href="/assets/js/97.f9d20d24.js"><link rel="prefetch" href="/assets/js/98.cb4974db.js"><link rel="prefetch" href="/assets/js/99.049f174b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0b94e76f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(https://picsum.photos/1920/250.webp);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          L.Rainçš„åšå®¢
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/" class="navbar-link" data-v-e4145d0a>
            ä¸»é¡µ
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            åˆ†ç±»
          </a><a href="https://github.com/baixiaoyu2997" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-e4145d0a><span data-v-e4145d0a>Github</span> <span data-v-e4145d0a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          Piniaå­¦ä¹ éšç¬”
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      å‘å¸ƒæ—¶é—´ : 2021-11-01
    </span> <span class="update-date" data-v-4e23451f>
      æœ€åä¿®æ”¹ : 2022-06-11
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2021/10/27/ui%E8%AE%BE%E8%AE%A1%E9%9A%8F%E7%AC%94.html" class="post-link" data-v-4e23451f>
      ä¸Šä¸€ç¯‡ : UIè®¾è®¡éšç¬”
    </a> <a href="/posts/2021/11/12/%E7%BB%84%E8%A3%85%E7%94%B5%E8%84%91%E6%8C%87%E5%8D%97.html" class="post-link" data-v-4e23451f>
      ä¸‹ä¸€ç¯‡ : ç»„è£…ç”µè„‘æŒ‡å—
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="header-anchor">#</a> ä»‹ç»</h2> <p>æ”¯æŒvue3ï¼Œä½œä¸ºvuex5è¿˜æ²¡å‡ºç°å‰çš„æ›¿ä»£å“ï¼Œæä¾›äº†åŒæ ·æ–¹ä¾¿çš„ä½¿ç”¨æ–¹å¼å’Œå¯¹<code>composition-api</code>çš„æ”¯æŒï¼Œæ¯ä¸ªstoreä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·æ›´åˆ©äºä»£ç æ‹†åˆ†å’Œtsæ¨ç†ã€‚</p> <p>piniaä¸­ä¸å†æœ‰mutations,æ‰€æœ‰åŠ¨ä½œç”±actionå®Œæˆ</p> <h3 id="å®šä¹‰store"><a href="#å®šä¹‰store" class="header-anchor">#</a> å®šä¹‰store</h3> <p>setupä¸­æ²¡æœ‰<code>usestore</code>çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªstoreæ˜¯æ²¡è¿˜æœ‰è¢«åˆ›å»ºçš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token comment">// useStore could be anything like useUser, useCart</span>
<span class="token comment">// the first argument is a unique id of the store across your application</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// other options...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="header-anchor">#</a> è¯­æ³•</h3> <p>piniaæ”¯æŒoptionå’Œsetupè¯­æ³•ï¼Œå¦‚æœä½¿ç”¨setupçš„è¯ï¼Œåˆ™ä¸æ”¯æŒ<code>$reset</code>ç­‰æ–¹æ³•</p> <h3 id="ä½¿ç”¨store"><a href="#ä½¿ç”¨store" class="header-anchor">#</a> ä½¿ç”¨store</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/stores/counter'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// you can return the whole store instance to use it in the template</span>
      store<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>storeæ˜¯è¢«reactiveåŒ…è£¹çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½è§£æ„,ç›´æ¥è®¿é—®å®ƒçš„å€¼ä¹Ÿä¸ç”¨å†™<code>.value</code></p> <p>åŒæ—¶ä½¿ç”¨å¤šä¸ªåŒåstoreåªä¼šè§¦å‘ä¸€æ¬¡å®ä¾‹åŒ–</p> <h3 id="é‡ç½®store"><a href="#é‡ç½®store" class="header-anchor">#</a> é‡ç½®store</h3> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">$reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åªèƒ½ç”¨åœ¨optionä¸­ï¼Œæ— æ³•åœ¨setupä¸­ä½¿ç”¨</span>
</code></pre></div><h3 id="ä¿®æ”¹å¤šä¸ªå€¼"><a href="#ä¿®æ”¹å¤šä¸ªå€¼" class="header-anchor">#</a> ä¿®æ”¹å¤šä¸ªå€¼</h3> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token operator">:</span>store<span class="token punctuation">.</span>counter<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span><span class="token string">'Abalam'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æˆ–è€…ä½¿ç”¨ä¸‹è¾¹è¿™ç§å†™æ³•ä¿®æ”¹æ•°ç»„ä¸­çš„å€¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>cartStore<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'shoes'</span><span class="token punctuation">,</span> quantity<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  state<span class="token punctuation">.</span>hasChanged <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="æ•´ä¸ªæ›¿æ¢store"><a href="#æ•´ä¸ªæ›¿æ¢store" class="header-anchor">#</a> æ•´ä¸ªæ›¿æ¢store</h3> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span>$state <span class="token operator">=</span> <span class="token punctuation">{</span> counter<span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Paimon'</span> <span class="token punctuation">}</span>
</code></pre></div><p>æˆ–è€…</p> <div class="language-js extra-class"><pre class="language-js"><code>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="ç›‘å¬"><a href="#ç›‘å¬" class="header-anchor">#</a> ç›‘å¬</h2> <h3 id="subscribe"><a href="#subscribe" class="header-anchor">#</a> $subscribe()</h3> <p>çŠ¶æ€è®¢é˜…ç»‘å®šåˆ°æ·»åŠ ä»–ä»¬çš„ç»„ä»¶ï¼Œå½“ç»„ä»¶å¸è½½æ—¶ï¼Œè®¢é˜…è‡ªåŠ¨åˆ é™¤ã€‚å¦‚æœæƒ³åœ¨ç»„ä»¶å¸è½½æ—¶ä¿æŒè®¢é˜…ï¼Œè¾“å…¥ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>true</code>,eg:<code>someStore.$subscribe(callback, true)</code>ã€‚ä¸watchç›¸æ¯”åªä¼šè§¦å‘ä¸€æ¬¡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>cartStore<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// import { MutationType } from 'pinia'</span>
  mutation<span class="token punctuation">.</span>type <span class="token comment">// 'direct' | 'patch object' | 'patch function'</span>
  <span class="token comment">// same as cartStore.$id</span>
  mutation<span class="token punctuation">.</span>storeId <span class="token comment">// 'cart'</span>
  <span class="token comment">// only available with mutation.type === 'patch object'</span>
  mutation<span class="token punctuation">.</span>payload <span class="token comment">// patch object passed to cartStore.$patch()</span>
  <span class="token comment">// persist the whole state to the local storage whenever it changes</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ç›‘å¬action"><a href="#ç›‘å¬action" class="header-anchor">#</a> ç›‘å¬action</h3> <p>ç›‘å¬actionï¼Œå¯ä»¥åœ¨æˆåŠŸä¹‹åè°ƒç”¨callbackï¼Œæˆ–è€…åœ¨æŠ¥é”™çš„æ—¶å€™æ‰§è¡Œå‡½æ•°ï¼Œä¸ç›‘å¬stateä¸€æ ·ï¼Œå¯ä»¥ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°é˜²æ­¢ç»„ä»¶å¸è½½åçš„é»˜è®¤è¡Œä¸ºã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> someStore<span class="token punctuation">.</span><span class="token function">$onAction</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">,</span> <span class="token comment">// name of the action</span>
    store<span class="token punctuation">,</span> <span class="token comment">// store instance, same as `someStore`</span>
    args<span class="token punctuation">,</span> <span class="token comment">// array of parameters passed to the action</span>
    after<span class="token punctuation">,</span> <span class="token comment">// hook after the action returns or resolves</span>
    onError<span class="token punctuation">,</span> <span class="token comment">// hook if the action throws or rejects</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// a shared variable for this specific action call</span>
    <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// è¿™å°†åœ¨actionæ‰§è¡Œä¹‹å‰æ‰§è¡Œ</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Start &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with params [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">].</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// æˆåŠŸåæ‰§è¡Œ</span>
    <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Finished &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
          Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime
        <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms.\nResult: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// æŠ¥é”™æˆ–è€…rejectæ—¶è§¦å‘</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms.\nError: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// æ‰‹åŠ¨åˆ é™¤ç›‘å¬</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="header-anchor">#</a> æ’ä»¶</h2> <p>æ’ä»¶åªèƒ½åœ¨åˆ›å»ºpiniaåæ‰èƒ½ä½¿ç”¨ã€‚piniaå¾ˆå®¹æ˜“è¿›è¡Œæ‰©å±•ï¼Œä½¿ç”¨useæ¥æ”¶ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸ºæ‰©å±•å†…å®¹ã€‚æ¯”å¦‚æ·»åŠ ä¸€ä¸ªæ‰€æœ‰storeéƒ½æœ‰çš„å±æ€§:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token comment">// add a property named `secret` to every store that is created after this plugin is installed</span>
<span class="token comment">// this could be in a different file</span>
<span class="token keyword">function</span> <span class="token function">SecretPiniaPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> secret<span class="token operator">:</span> <span class="token string">'the cake is a lie'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// give the plugin to pinia</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>SecretPiniaPlugin<span class="token punctuation">)</span>
<span class="token comment">// in another file</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
store<span class="token punctuation">.</span>secret <span class="token comment">// 'the cake is a lie'</span>
</code></pre></div><p>æ‰©å±•å‡½æ•°æ¥æ”¶ä¸€ä¸ªcontextå‚æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">myPiniaPlugin</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span>pinia <span class="token comment">// the pinia created with `createPinia()`</span>
  context<span class="token punctuation">.</span>app <span class="token comment">// the current app created with `createApp()` (Vue 3 only)</span>
  context<span class="token punctuation">.</span>store <span class="token comment">// the store the plugin is augmenting</span>
  context<span class="token punctuation">.</span>options <span class="token comment">// the options object defining the store passed to `defineStore()`</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ’ä»¶ä¸­çš„çŠ¶æ€å…±ç”¨"><a href="#æ’ä»¶ä¸­çš„çŠ¶æ€å…±ç”¨" class="header-anchor">#</a> æ’ä»¶ä¸­çš„çŠ¶æ€å…±ç”¨</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sharedRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'shared'</span><span class="token punctuation">)</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ¯ä¸€ä¸ªstoreéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„secret</span>
  store<span class="token punctuation">.</span>hello <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'secret'</span><span class="token punctuation">)</span>
  <span class="token comment">// è‡ªåŠ¨è§£åŒ…</span>
  store<span class="token punctuation">.</span>hello <span class="token comment">// 'secret'</span>
  <span class="token comment">// æ‰€æœ‰storeå…±ç”¨shared</span>
  store<span class="token punctuation">.</span>shared <span class="token operator">=</span> sharedRef
  store<span class="token punctuation">.</span>shared <span class="token comment">// 'shared'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="æ·»åŠ æ–°state"><a href="#æ·»åŠ æ–°state" class="header-anchor">#</a> æ·»åŠ æ–°state</h3> <p>æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p> <ol><li>ç›´æ¥ä½¿ç”¨store.xxxè®¾ç½®æ–°å€¼</li> <li>store.$state.xxx=xxx ï¼Œè¿™ç§æ–¹æ³•ä¼šè¢«devtoolæ£€æµ‹åˆ°ï¼Œåœ¨ssræœŸé—´ä¼šè¢«åºåˆ—åŒ–ã€‚</li></ol> <p>å¦‚æœä½¿ç”¨çš„æ˜¯vue2ï¼Œé‚£ä¹ˆéœ€è¦å€ŸåŠ©<code>set</code>è®¾ç½®æ–°å€¼</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> set <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>$state<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> secretRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'secret'</span><span class="token punctuation">)</span>
    <span class="token comment">// If the data is meant to be used during SSR, you should</span>
    <span class="token comment">// set it on the `$state` property so it is serialized and</span>
    <span class="token comment">// picked up during hydration</span>
    <span class="token function">set</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>$state<span class="token punctuation">,</span> <span class="token string">'secret'</span><span class="token punctuation">,</span> secretRef<span class="token punctuation">)</span>
    <span class="token comment">// set it directly on the store too so you can access it</span>
    <span class="token comment">// both ways: `store.$state.secret` / `store.secret`</span>
    <span class="token function">set</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> <span class="token string">'secret'</span><span class="token punctuation">,</span> secretRef<span class="token punctuation">)</span>
    store<span class="token punctuation">.</span>secret <span class="token comment">// 'secret'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="æ·»åŠ å¤–éƒ¨å±æ€§"><a href="#æ·»åŠ å¤–éƒ¨å±æ€§" class="header-anchor">#</a> æ·»åŠ å¤–éƒ¨å±æ€§</h3> <p>æ·»åŠ å¤–éƒ¨å±æ€§æˆ–è€…ä¸æ˜¯å“åº”å¼å¯¹è±¡æ—¶ï¼Œåº”è¯¥ç”¨markRawåŒ…è£¹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> markRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">// adapt this based on where your router isj</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./router'</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span>router <span class="token operator">=</span> <span class="token function">markRaw</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ç›‘å¬stateå’Œaction"><a href="#ç›‘å¬stateå’Œaction" class="header-anchor">#</a> ç›‘å¬stateå’Œaction</h3> <p>æ’ä»¶å†…éƒ¨ä¹Ÿå¯ä»¥subscribeï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// react to store changes</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">$onAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// react to store actions</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="è¯»å–storeä¸­çš„option"><a href="#è¯»å–storeä¸­çš„option" class="header-anchor">#</a> è¯»å–storeä¸­çš„option</h3> <p>setupè¯­æ³•ä¸­ï¼Œ<code>defineStore</code>å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º<code>options</code>,æ’ä»¶ä¸­å¯ä»¥è¯»å–</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// use any debounce library</span>
<span class="token keyword">import</span> debounce <span class="token keyword">from</span> <span class="token string">'lodash/debunce'</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> options<span class="token punctuation">,</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>debounce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we are overriding the actions with new ones</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>debounce<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">debouncedActions<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      debouncedActions<span class="token punctuation">[</span>action<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span>
        store<span class="token punctuation">[</span>action<span class="token punctuation">]</span><span class="token punctuation">,</span>
        options<span class="token punctuation">.</span>debounce<span class="token punctuation">[</span>action<span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">return</span> debouncedActions
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="nuxtä¸­ä½¿ç”¨plugin"><a href="#nuxtä¸­ä½¿ç”¨plugin" class="header-anchor">#</a> nuxtä¸­ä½¿ç”¨plugin</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// plugins/myPiniaPlugin.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PiniaPluginContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Plugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nuxt/types'</span>
<span class="token keyword">function</span> <span class="token function">MyPiniaPlugin</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// react to store changes</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[ğŸ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mutation<span class="token punctuation">.</span>storeId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mutation<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> creationTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> myPlugin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> pinia <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MyPiniaPlugin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> myPlugin
</code></pre></div><h2 id="ç»„ä»¶å¤–ä½¿ç”¨"><a href="#ç»„ä»¶å¤–ä½¿ç”¨" class="header-anchor">#</a> ç»„ä»¶å¤–ä½¿ç”¨</h2> <h3 id="spa"><a href="#spa" class="header-anchor">#</a> spa</h3> <p>spaä¸­å¿…é¡»è¦ç­‰å¾…<code>createApp</code>ä¹‹åæ‰èƒ½ä½¿ç”¨<code>useStore</code>,è¿˜è¦æ³¨æ„ä½¿ç”¨é¡ºåºï¼Œæ¯”å¦‚routerä¸­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// âŒ Depending on the order of imports this will fail</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// we wanted to use the store here</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">)</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… This will work because the router starts its navigation after</span>
  <span class="token comment">// the router is installed and pinia will be installed too</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requiresAuth <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>store<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'/login'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>	
</code></pre></div><h3 id="ssr"><a href="#ssr" class="header-anchor">#</a> ssr</h3> <h4 id="vueå’Œvite"><a href="#vueå’Œvite" class="header-anchor">#</a> vueå’Œvite</h4> <blockquote><p>è¯¦æƒ…æŸ¥çœ‹https://pinia.esm.dev/ssr/#state-hydration</p></blockquote> <p>éœ€è¦ä¼ é€’piniaå®ä¾‹ç»™useStoreï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… This will work make sure the correct store is used for the</span>
  <span class="token comment">// current running app</span>
  <span class="token keyword">const</span> main <span class="token operator">=</span> <span class="token function">useMainStore</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requiresAuth <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>main<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'/login'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>	
</code></pre></div><p>piniaè¿˜æä¾›äº†<code>$pinia</code>ç»™å½“å‰åº”ç”¨å®ä¾‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">serverPrefetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$pinia<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="nuxt"><a href="#nuxt" class="header-anchor">#</a> nuxt</h4> <p><code>$pinia</code>ä¼šè¢«æ³¨å…¥åˆ°<code>context</code>ä¸­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'~/stores/myStore'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $pinia <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span>$pinia<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>	
</code></pre></div></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      å‘å¸ƒæ—¶é—´ : 2021-11-01
    </span> <span class="update-date" data-v-4e23451f>
      æœ€åä¿®æ”¹ : 2022-06-11
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2021/10/27/ui%E8%AE%BE%E8%AE%A1%E9%9A%8F%E7%AC%94.html" class="post-link" data-v-4e23451f>
      ä¸Šä¸€ç¯‡ : UIè®¾è®¡éšç¬”
    </a> <a href="/posts/2021/11/12/%E7%BB%84%E8%A3%85%E7%94%B5%E8%84%91%E6%8C%87%E5%8D%97.html" class="post-link" data-v-4e23451f>
      ä¸‹ä¸€ç¯‡ : ç»„è£…ç”µè„‘æŒ‡å—
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" data-v-9d847660><img src="https://avatars.githubusercontent.com/baixiaoyu2997?s=120" alt="L.Rain" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      L.Rain
    </section> <section class="info-desc" data-v-9d847660>çœŸå®ã€è‡ªç”±ã€å®½å®¹</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="ChengDu City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>ChengDu City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          ChengDu City, China
        </span></span></section> <section data-v-9d847660><span title="ChengDu YeeYun Technology" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>ChengDu YeeYun Technology</title><use xlink:href="#icon-organization" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          ChengDu YeeYun Technology
        </span></span></section> <section data-v-9d847660><a href="mailto:bxy2997@sina.com" title="bxy2997@sina.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>bxy2997@sina.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          bxy2997@sina.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/baixiaoyu2997" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: L.Rain" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: L.Rain</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a><a href="https://weibo.com/1504398495" target="_blank" class="sns-link" data-v-9d847660><span title="æ–°æµªå¾®åš: ç™½æ™“å®‡V" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>æ–°æµªå¾®åš: ç™½æ™“å®‡V</title><use xlink:href="#icon-weibo" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>æ–‡ç« ç›®å½•</span> <div class="post-nav-toc"><ul><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ä»‹ç»">ä»‹ç»</a><ul><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#å®šä¹‰store">å®šä¹‰store</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#è¯­æ³•">è¯­æ³•</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ä½¿ç”¨store">ä½¿ç”¨store</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#é‡ç½®store">é‡ç½®store</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ä¿®æ”¹å¤šä¸ªå€¼">ä¿®æ”¹å¤šä¸ªå€¼</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#æ•´ä¸ªæ›¿æ¢store">æ•´ä¸ªæ›¿æ¢store</a></li></ul></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ç›‘å¬">ç›‘å¬</a><ul><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#subscribe">$subscribe()</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ç›‘å¬action">ç›‘å¬action</a></li></ul></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#æ’ä»¶">æ’ä»¶</a><ul><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#æ’ä»¶ä¸­çš„çŠ¶æ€å…±ç”¨">æ’ä»¶ä¸­çš„çŠ¶æ€å…±ç”¨</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#æ·»åŠ æ–°state">æ·»åŠ æ–°state</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#æ·»åŠ å¤–éƒ¨å±æ€§">æ·»åŠ å¤–éƒ¨å±æ€§</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ç›‘å¬stateå’Œaction">ç›‘å¬stateå’Œaction</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#è¯»å–storeä¸­çš„option">è¯»å–storeä¸­çš„option</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#nuxtä¸­ä½¿ç”¨plugin">nuxtä¸­ä½¿ç”¨plugin</a></li></ul></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ç»„ä»¶å¤–ä½¿ç”¨">ç»„ä»¶å¤–ä½¿ç”¨</a><ul><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#spa">spa</a></li><li><a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#ssr">ssr</a></li></ul></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2021/11/01/pinia%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94.html#post-comments">
      è¯„è®º
    </a></div></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/baixiaoyu2997" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: L.Rain" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: L.Rain</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a><a href="https://weibo.com/1504398495" target="_blank" class="sns-link" data-v-1375e54c><span title="æ–°æµªå¾®åš: ç™½æ™“å®‡V" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>æ–°æµªå¾®åš: ç™½æ™“å®‡V</title><use xlink:href="#icon-weibo" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <p class="footer-text" data-v-1375e54c><span data-v-1375e54c>Powered by </span> <a href="https://github.com/vuejs/vuepress" target="_blank" data-v-1375e54c>
      VuePress
    </a> <span data-v-1375e54c> | </span> <a href="https://github.com/meteorlxy/vuepress-theme-meteorlxy" target="_blank" data-v-1375e54c>
        meteorlxy
      </a></p> <!----></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f3f948e5.js" defer></script><script src="/assets/js/7.8545d9f8.js" defer></script><script src="/assets/js/37.1426b4d7.js" defer></script>
  </body>
</html>
