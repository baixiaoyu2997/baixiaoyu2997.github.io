(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{501:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"学习进度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习进度"}},[t._v("#")]),t._v(" 学习进度")]),t._v(" "),a("p",[t._v("https://cn.vitejs.dev/guide/features.html#build-optimizations")]),t._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("vite有几个比较重要的概念：")]),t._v(" "),a("h3",{attrs:{id:"预构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预构建"}},[t._v("#")]),t._v(" 预构建")]),t._v(" "),a("p",[t._v("使用esbuild执行预构建，速度非常快。在服务器已经启动之后，如果遇到一个新的依赖关系导入，而这个依赖关系还没有在缓存中，Vite 将重新运行依赖构建进程并重新加载页面。")]),t._v(" "),a("h4",{attrs:{id:"为什么需要与构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要与构建"}},[t._v("#")]),t._v(" 为什么需要与构建？")]),t._v(" "),a("ol",[a("li",[t._v("兼容性：因为vite对待所有js文件都当作es模块处理，所以需要先将cjs和umd转换为"),a("code",[t._v("es module")])]),t._v(" "),a("li",[t._v("性能：Vite 将有许多内部模块的 ESM 依赖关系转换为单个模块，以提高后续页面加载性能。例如：当我们执行 "),a("code",[t._v("import { debounce } from 'lodash-es'")]),t._v(" 时，浏览器同时发出 600 多个 HTTP 请求！通过预构建 "),a("code",[t._v("lodash-es")]),t._v(" 成为一个模块，我们就只需要一个 HTTP 请求了！")])]),t._v(" "),a("h3",{attrs:{id:"缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[t._v("#")]),t._v(" 缓存")]),t._v(" "),a("h4",{attrs:{id:"文件缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件缓存"}},[t._v("#")]),t._v(" 文件缓存")]),t._v(" "),a("p",[t._v("Vite 会将预构建的依赖缓存到 "),a("code",[t._v("node_modules/.vite")]),t._v("，以下有变动时会重新构建：")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("package.json")]),t._v(" 中的 "),a("code",[t._v("dependencies")]),t._v(" 列表")]),t._v(" "),a("li",[t._v("包管理器的 lockfile，例如 "),a("code",[t._v("package-lock.json")]),t._v(", "),a("code",[t._v("yarn.lock")]),t._v("，或者 "),a("code",[t._v("pnpm-lock.yaml")])]),t._v(" "),a("li",[t._v("可能在 "),a("code",[t._v("vite.config.js")]),t._v(" 相关字段中配置过的")])]),t._v(" "),a("p",[t._v("想重新构建可以在启动命令行后输入"),a("code",[t._v("--force")]),t._v("，或者手动删除"),a("code",[t._v("node_modules/.vite")])]),t._v(" "),a("h4",{attrs:{id:"浏览器缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存"}},[t._v("#")]),t._v(" 浏览器缓存")]),t._v(" "),a("p",[t._v("解析后的依赖请求会以 HTTP 头 "),a("code",[t._v("max-age=31536000,immutable")]),t._v(" 强缓存，以提高在开发时的页面重载性能。一旦被缓存，这些请求将永远不会再到达开发服务器")]),t._v(" "),a("h2",{attrs:{id:"功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[t._v("#")]),t._v(" 功能")]),t._v(" "),a("h3",{attrs:{id:"css"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css"}},[t._v("#")]),t._v(" css")]),t._v(" "),a("p",[t._v("内置支持"),a("code",[t._v("@import")]),t._v("内联和变基、PostCSS、 CSS Modules。支持CSS 预处理器,"),a("code",[t._v(".scss")]),t._v(", "),a("code",[t._v(".sass")]),t._v(", "),a("code",[t._v(".less")]),t._v(", "),a("code",[t._v(".styl")]),t._v(" 和 "),a("code",[t._v(".stylus")]),t._v(" 文件都是内置支持的，需要手动安装相应依赖，例如：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D sass\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .less")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("less")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .styl and .stylus")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -D stylus\n")])])]),a("h2",{attrs:{id:"静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源"}},[t._v("#")]),t._v(" 静态资源")]),t._v(" "),a("p",[t._v("vite默认支持的资源加载类型为：https://github.com/vitejs/vite/blob/main/packages/vite/src/node/constants.ts#L49")]),t._v(" "),a("h2",{attrs:{id:"插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件"}},[t._v("#")]),t._v(" 插件")]),t._v(" "),a("h3",{attrs:{id:"vite-plugin-singlefile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vite-plugin-singlefile"}},[t._v("#")]),t._v(" vite-plugin-singlefile")]),t._v(" "),a("p",[t._v("内联js和css文件")]),t._v(" "),a("h3",{attrs:{id:"vite-plugin-imp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vite-plugin-imp"}},[t._v("#")]),t._v(" vite-plugin-imp")]),t._v(" "),a("p",[t._v("自动引入组件库样式文件")]),t._v(" "),a("h2",{attrs:{id:"迁移指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移指南"}},[t._v("#")]),t._v(" 迁移指南")]),t._v(" "),a("p",[t._v("从webpack迁移到vite是一个很繁琐的事情，好在有"),a("code",[t._v("wp2vite")]),t._v("这个包自动帮我们实现这些步骤")]),t._v(" "),a("blockquote",[a("p",[t._v("迁移参考：")]),t._v(" "),a("ol",[a("li",[t._v("https://cloud.tencent.com/developer/article/1819625")])])]),t._v(" "),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),a("h3",{attrs:{id:"vite运行dev报错-then-it-is-likely-the-case-that-a-known-bug-in-npm-v7-hascorrupted-your-package-lock-json-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vite运行dev报错-then-it-is-likely-the-case-that-a-known-bug-in-npm-v7-hascorrupted-your-package-lock-json-file"}},[t._v("#")]),t._v(" vite运行dev报错：then it is likely the case that a known bug in npm v7 hascorrupted your package-lock.json file")]),t._v(" "),a("p",[t._v("这是"),a("code",[t._v("esbuild")]),t._v("的bug，针对"),a("code",[t._v("npm")]),t._v("版本大于7的解决办法："),a("code",[t._v("node node_modules/esbuild/install.js")])]),t._v(" "),a("p",[t._v("问题链接：https://github.com/evanw/esbuild/issues/462")]),t._v(" "),a("h3",{attrs:{id:"如何删除build后的hashname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何删除build后的hashname"}},[t._v("#")]),t._v(" 如何删除build后的hashname？")]),t._v(" "),a("p",[t._v("参考：https://github.com/vitejs/vite/issues/378#issuecomment-789366197")]),t._v(" "),a("p",[t._v("但是，资源assetFileNames无效，需要升级到"),a("code",[t._v("vite@2.5.0-beta.1")]),t._v("或更高，链接：https://github.com/vitejs/vite/issues/4354#issuecomment-895231516")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  build"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rollupOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        entryFileNames"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("assets/[name].js")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 作用于入口包装文件")]),t._v("\n        chunkFileNames"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("assets/[name].js")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 作用于js文件")]),t._v("\n        assetFileNames"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("assets/[name].[ext]")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 作用于css、图片等静态资源")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);